(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["tabs"],{"0c97":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-lx-cascades"}),e._v(" 表格资料\n            ")])],1)],1),a("div",{staticClass:"container"},[a("div",{staticClass:"handle-box"},["主管"===e.usertype||"主管老师"===e.usertype?a("el-button",{staticClass:"handle-add mr10",attrs:{type:"primary",icon:"el-icon-lx-tag"},on:{click:e.open1}},[e._v("新增表格")]):e._e()],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"table",staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-cell-class-name":"table-header"}},[a("el-table-column",{attrs:{width:"200",align:"center"}}),a("el-table-column",{attrs:{width:"450",prop:"title",label:"名称",align:"left"}}),a("el-table-column",{attrs:{label:"操作",width:"600",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",icon:"el-icon-view"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("查看")]),"主管"===e.usertype||"主管老师"===e.usertype?a("el-button",{staticStyle:{color:"#E6A23C"},attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.handleRename(t.row)}}},[e._v("修改名称")]):e._e(),"主管"===e.usertype||"主管老师"===e.usertype?a("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")]):e._e()]}}])})],1)],1),a("el-dialog",{attrs:{title:"编辑",visible:e.editVisible,width:"30%"},on:{"update:visible":function(t){e.editVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"70px"}},[a("el-divider"),a("el-form-item",{attrs:{label:"表格标题"}},[a("el-input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.editVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.handleRename2}},[e._v("确 定")])],1)],1),"主管"===e.usertype||"主管老师"===e.usertype?a("el-upload",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"quillUploader",staticClass:"avatar-uploader",attrs:{action:e.photoUrl,"show-file-list":!1,"auto-upload":!0,"on-success":e.onChangeQuill,"on-error":e.onError,limit:20,multiple:!0}}):e._e()],1)},l=[],o={name:"Table",data:function(){return{tableData:[],form:{title:"",id:""},editVisible:!1,id:"",photoUrl:"http://localhost:8444/api/TableUpload",loading:!0,usertype:""}},created:function(){this.getData()},methods:{getData:function(){var e=this;this.loading=!0,this.$axios.get("/Table").then((function(t){e.tableData=t.data.data,e.usertype=localStorage.getItem("type"),200===t.data.code?e.tableData=t.data.data:400===t.data.code?e.$message.error("查询失败:"+t.data.message):403===t.data.code?(e.$message.error("查询失败:"+t.data.message),e.loading=!1,e.$router.push({path:"/login"})):500===t.data.code&&alert("请截图以下信息报给维护员: 出错位置：table.getdata 出错详情: "+t.data.message),e.loading=!1})).catch((function(t){e.$message.error(t.message)}))},handleEdit:function(e){this.$router.push({path:"/tableinfo",query:{id:e.id}})},handleRename2:function(){var e=this;this.editVisible=!1,this.loading=!0,this.$axios.post("/TableRename",{title:this.form.title,id:this.form.id}).then((function(t){200===t.data.code?(e.$message.success("重命名成功"),e.getData()):400===t.data.code?e.$message.error("失败:"+t.data.message):403===t.data.code?(e.$message.error("失败:"+t.data.message),e.loading=!1,e.$router.push({path:"/login"})):500===t.data.code&&alert("请截图以下信息报给维护员: 出错位置：table.handlerename2 出错详情: "+res1.data.message),e.loading=!1})).catch((function(t){e.$message.error(t.message)}))},handleRename:function(e){this.form.title=e.title,this.form.id=e.id,this.editVisible=!0},handleDelete:function(e){var t=this;this.$confirm("确定要删除吗？","提示",{type:"warning"}).then((function(){t.loading=!0,t.$axios.post("/TableDelete",{id:e.id}).then((function(e){200===e.data.code?(t.getData(),t.$message.success("删除成功"),t.loading=!1):400===e.data.code?t.$message.error("失败:"+e.data.message):403===e.data.code?(t.$message.error("失败:"+e.data.message),t.loading=!1,t.$router.push({path:"/login"})):500===e.data.code&&alert("请截图以下信息报给维护员: 出错位置：table.handleDelete 出错详情: "+e.data.message),t.loading=!1})).catch((function(e){t.$message.error(e.message)}))})).catch((function(){}))},open1:function(){document.querySelector(".avatar-uploader input").click()},onError:function(e,t,a){alert("上传错误"+e)},onChangeQuill:function(e,t,a){console.log(e.data);var s=this.$refs.myTextEditor.quill;s.getSelection().index,e.data;200===e.data.code?(this.$message.success("上传成功"),this.getData()):400===e.data.code?this.$message.error("上传失败,"+e.data.message):500===e.data.code?alert("请截图以下信息报给维护员: 出错位置：table.upload 出错详情: "+e.data.message):403===e.data.code&&this.$message.error("登录过期，请重新登录")}},watch:{$route:{handler:function(e,t){var a=this;"/table"===e.path&&a.getData()},deep:!0}}},i=o,n=(a("660f"),a("2877")),r=Object(n["a"])(i,s,l,!1,null,"2f22b292",null);t["default"]=r.exports},"660f":function(e,t,a){"use strict";var s=a("9cf9"),l=a.n(s);l.a},"7e0a":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-lx-cascades"}),e._v(" 表格详情\n            ")])],1)],1),a("div",{staticClass:"container",staticStyle:{overflow:"auto"}},[a("div",{staticClass:"handle-box"},[a("el-input",{staticClass:"handle-input mr10",attrs:{placeholder:"搜索"},model:{value:e.schfilter,callback:function(t){e.schfilter=t},expression:"schfilter"}}),a("el-button",{staticClass:"handle-select",attrs:{type:"primary"}},[e._v("搜索")]),!0===e.showSelect?a("el-select",{staticClass:"handle-select mr10",attrs:{placeholder:"在职状况"},on:{change:function(t){return e.selectTrigger(e.selectData)}},model:{value:e.selectData,callback:function(t){e.selectData=t},expression:"selectData"}},[a("el-option",{key:"%",attrs:{label:"所有类别",value:"%"}}),a("el-option",{key:"1",attrs:{label:"在职",value:"1"}}),a("el-option",{key:"2",attrs:{label:"离职",value:"2"}})],1):e._e(),a("el-button",{staticClass:"handle-select",attrs:{type:"warning"},on:{click:e.handleDownload}},[e._v("下载")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"table",staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-cell-class-name":"table-header",fit:"fit",id:"out-table"}},[a("el-table-column",{attrs:{prop:e.id,label:"行数",align:"center",width:"5"}}),e._l(this.tableData[0],(function(e,t){return a("el-table-column",{attrs:{prop:t,label:t,sortable:"",align:"center"}})})),a("el-table-column",{attrs:{label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.handleEdit(t.$index)}}},[e._v("编辑")]),a("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.handleDelete(t.row.id)}}},[e._v("删除")])]}}])})],2)],1),a("el-dialog",{attrs:{title:"编辑",visible:e.editVisible,width:"30%"},on:{"update:visible":function(t){e.editVisible=t}}},[a("el-form",{ref:"tableData",attrs:{model:e.tableData,"label-width":"70px"}},[a("el-divider"),e._l(this.tableData[0],(function(t,s){return a("el-form-item",{attrs:{label:s}},[a("el-input",{model:{value:e.tableData[e.form][s],callback:function(t){e.$set(e.tableData[e.form],s,t)},expression:"tableData[form][key]"}})],1)}))],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.editVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveEdit}},[e._v("确 定")])],1)],1)],1)},l=[],o=(a("6762"),a("2fdb"),a("ac6a"),a("456d"),a("6b54"),a("21a6")),i=a.n(o),n=a("1146"),r=a.n(n),c={name:"TableInfo",data:function(){return{parentContent:"",otableData:[],schfilter:"",loading:!0,id:"",form:"1",editVisible:"false",fit:!0,showSelect:!1,selectData:""}},created:function(){this.getData()},computed:{tableData:function(){var e=this.schfilter.toString().toLowerCase();return e?this.otableData.filter((function(t){return Object.keys(t).some((function(a){return String(t[a]).toLowerCase().includes(e)}))})):this.otableData}},methods:{getData:function(){var e=this;this.editVisible=!1,this.loading=!0,this.$axios.post("/TableQuery",{id:this.$route.query.id}).then((function(t){if(200===t.data.code){e.id=e.$route.query.id,"1协管员通讯录"===t.data.data.title?e.showSelect=!0:e.showSelect=!1;for(var a=JSON.parse(decodeURIComponent(t.data.data.table)),s=[],l=1;l<a.length;l++){var o={};o["id"]=l;for(var i=0;i<a[0].length;i++)o[a[0][i]]=a[l][i];s.push(o)}e.otableData=s}else 400===t.data.code?e.$message.error("查询失败:"+t.data.message):403===t.data.code?(e.$message.error("查询失败:"+t.data.message),e.loading=!1,e.$router.push({path:"/login"})):500===t.data.code&&alert("请截图以下信息报给维护员: 出错位置：tableinfo.getdata 出错详情: "+t.data.message);e.loading=!1})).catch((function(t){e.$message.error(t.message)}))},handleDelete:function(e){var t=this;this.$confirm("确定要删除吗？","提示",{type:"warning"}).then((function(){for(var a=0;a<t.otableData.length;a++)t.otableData[a].id===e&&t.otableData.splice(a,1);var s=t.otableData,l=[];for(a=0;a<s.length;a++){var o=[];0===a&&(Object.getOwnPropertyNames(s[a]).forEach((function(e){o.push(e)})),l.push(o)),o=[];var i=Object.getOwnPropertyNames(s[a]);i.pop(),i.forEach((function(e){o.push(s[a][e])})),l.push(o)}var n=encodeURIComponent(JSON.stringify(l));t.loading=!0,t.$axios.post("/TableUpdate",{id:t.id,table:n}).then((function(e){200===e.data.code?(t.getData(),t.$message.success("删除成功"),t.loading=!1,t.getData()):400===e.data.code?t.$message.error("失败:"+e.data.message):403===e.data.code?(t.$message.error("失败:"+e.data.message),t.loading=!1,t.$router.push({path:"/login"})):500===e.data.code&&alert("请截图以下信息报给维护员: 出错位置：tableinfo.handleDelete.res6 出错详情: "+e.data.message),t.loading=!1})).catch((function(e){t.$message.error(e.message)}))})).catch((function(e){t.$message.error(res7.message)}))},handleEdit:function(e,t){this.form=e,this.editVisible=!0},saveEdit:function(){for(var e=this,t=this.otableData,a=[],s=0;s<t.length;s++){var l=[];0===s&&(Object.getOwnPropertyNames(t[s]).forEach((function(e){l.push(e)})),a.push(l)),l=[];var o=Object.getOwnPropertyNames(t[s]);o.pop(),o.forEach((function(e){l.push(t[s][e])})),a.push(l)}var i=encodeURIComponent(JSON.stringify(a));this.loading=!0,this.$axios.post("/TableUpdate",{id:this.id,table:i}).then((function(t){200===t.data.code?(e.getData(),e.$message.success("修改成功"),e.loading=!1,e.getData()):400===t.data.code?e.$message.error("失败:"+t.data.message):403===t.data.code?(e.$message.error("失败:"+t.data.message),e.loading=!1,e.$router.push({path:"/login"})):500===t.data.code&&alert("请截图以下信息报给维护员: 出错位置：monney.getdata 出错详情: "+t.data.message),e.loading=!1})).catch((function(t){e.$message.error(t.message)}))},selectTrigger:function(e){"1"===e?this.schfilter="在职":"2"===e?this.schfilter="离职":"%"===e&&(this.schfilter="")},handleDownload:function(){var e=r.a.utils.table_to_book(document.querySelector("#out-table")),t=r.a.write(e,{bookType:"xlsx",bookSST:!0,type:"array"});try{i.a.saveAs(new Blob([t],{type:"application/octet-stream"}),"导出的表格.xlsx")}catch(a){"undefined"!==typeof console&&console.log(a,t)}return t}},watch:{$route:{handler:function(e,t){var a=this;"/tableinfo"===e.path&&a.getData()},deep:!0}}},d=c,u=(a("8d36"),a("2877")),h=Object(u["a"])(d,s,l,!1,null,"2ce95bd8",null);t["default"]=h.exports},"8d36":function(e,t,a){"use strict";var s=a("ad7e"),l=a.n(s);l.a},"9cf9":function(e,t,a){},ad7e:function(e,t,a){}}]);